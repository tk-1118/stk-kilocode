# HN Code 团队化开发系统设计

## 概述

本设计将 HN Code 从单一的模式选择系统升级为团队化的开发系统，让用户感知到真正有一个开发团队在协作工作，而不是单独的 AI 助手。

## 核心设计理念

### 1. 团队化体验

- **从模式切换到团队切换**：用户不再选择单个模式，而是选择开发团队
- **成员协作感知**：显示当前活跃的团队成员和工作状态
- **智能团队推荐**：基于项目特征自动推荐最适合的开发团队

### 2. 专业分工

- **前端开发团队**：专注于 UI/UX，包含组件开发、页面集成等专业角色
- **后端开发团队**：专注于服务端架构，包含所有 DDD 相关的专业模式
- **全栈开发团队**：具备前后端全栈能力，可访问所有模式

### 3. 智能识别

- **项目类型检测**：分析文件模式、目录结构、配置文件、依赖包
- **自动团队切换**：基于项目特征自动推荐并切换到合适的团队
- **置信度评估**：提供检测置信度和推荐理由

## 系统架构

### 核心组件

#### 1. 类型定义 (`packages/types/src/team.ts`)

```typescript
// 团队配置
interface TeamConfig {
  slug: string                    // 团队标识
  name: string                    // 团队名称
  description?: string            // 团队描述
  iconName?: string              // 团队图标
  color?: string                 // 团队主题色
  baseModes: string[]            // 基础模式列表
  specialtyModes: string[]       // 专业模式列表
  projectDetection?: {...}       // 项目检测规则
  collaboration?: {...}          // 团队协作配置
}

// 团队成员角色
interface TeamMemberRole {
  slug: string                   // 成员标识
  name: string                   // 成员名称
  specialty: string              // 专业领域
  description?: string           // 成员描述
}

// 团队工作状态
interface TeamWorkStatus {
  currentTeam: string            // 当前团队
  activeMembers: string[]        // 活跃成员
  currentTask?: string           // 当前任务
  workflowStage?: string         // 工作流程阶段
}
```

#### 2. 团队管理逻辑 (`src/shared/teams.ts`)

- `getAllTeams()` - 获取所有团队配置
- `detectProjectTeam()` - 智能检测项目类型
- `autoSwitchTeam()` - 自动切换团队
- `recommendTeamMember()` - 推荐团队成员

#### 3. UI 组件

- `TeamSelector` - 团队选择器
- `ActiveTeamMember` - 活跃成员显示
- `TeamWorkStatus` - 团队工作状态
- `TeamCollaborationStatus` - 团队协作状态

### 默认团队配置

#### 前端开发团队

- **基础模式**: architect, code, ask, debug
- **专业模式**: 待扩展前端专业模式
- **检测规则**:
    - 文件: `*.tsx, *.jsx, *.vue, *.html, *.css`
    - 配置: `package.json, vite.config.*, webpack.config.*`
    - 依赖: `react, vue, angular, vite, webpack`

#### 后端开发团队

- **基础模式**: architect, code, ask, debug
- **专业模式**:
    - `product-project-coder-agent` - 产品智能体
    - `domain-model-and-value-object-coder-agent` - 领域模型智能体
    - 等 DDD 相关的所有专业模式
- **检测规则**:
    - 文件: `*.java, *.kt, *.py, *.go`
    - 配置: `pom.xml, build.gradle, application.yml`
    - 依赖: `spring, springboot, maven, gradle`

#### 全栈开发团队

- **基础模式**: architect, code, ask, debug, orchestrator
- **专业模式**: 可访问所有专业模式
- **检测规则**: 混合前后端特征的项目

## 用户体验设计

### 1. 聊天界面变化

- **左下角团队选择器**：替换原有的模式选择器
- **活跃成员显示**：显示当前工作的团队成员和角色
- **团队主题色**：每个团队有独特的主题色标识

### 2. 团队协作感知

- **实时活动流**：显示团队成员的工作活动
- **工作流程进度**：显示当前所在的工作流程阶段
- **成员状态指示**：显示哪些成员正在活跃工作

### 3. 智能推荐体验

- **自动检测提示**：当检测到项目类型时自动提示切换团队
- **检测置信度**：显示检测的可信度和推荐理由
- **手动确认**：用户可以接受或拒绝自动推荐

## 实现状态

### ✅ 已完成

1. **核心类型定义** - 团队、成员、工作状态等类型
2. **团队管理逻辑** - 团队获取、项目检测、自动切换
3. **UI 组件开发** - 团队选择器、成员显示、协作状态
4. **前端集成** - 在聊天界面集成团队选择器
5. **国际化支持** - 添加团队相关的多语言支持

### 🚧 待完成

1. **扩展消息类型** - 添加团队相关的 VSCode 消息类型
2. **后端集成** - 在扩展后端实现团队切换逻辑
3. **状态持久化** - 保存用户的团队选择和工作状态
4. **前端专业模式** - 开发前端特有的专业模式
5. **高级检测规则** - 完善项目类型检测算法

## 使用指南

### 开发者使用

1. **选择团队**：在聊天界面左下角选择合适的开发团队
2. **查看成员**：观察当前活跃的团队成员和工作状态
3. **智能切换**：允许系统根据项目特征自动推荐团队
4. **成员协作**：点击团队成员可以直接切换到对应的专业模式

### 扩展开发

1. **添加新团队**：在 `DEFAULT_TEAMS` 中定义新的团队配置
2. **自定义检测**：在 `projectDetection` 中添加项目检测规则
3. **扩展成员角色**：在 `memberRoles` 中定义团队成员角色
4. **添加专业模式**：将新的专业模式添加到对应团队的 `specialtyModes`

## 技术细节

### 项目检测算法

1. **文件模式匹配** - 统计匹配特定模式的文件数量
2. **配置文件检测** - 检查是否存在特定的配置文件
3. **依赖分析** - 分析 package.json、pom.xml 等依赖文件
4. **目录结构** - 检查是否存在特定的目录结构
5. **置信度计算** - 基于多个因素计算推荐置信度

### 状态管理

- **扩展状态** - 在 ExtensionStateContext 中管理团队状态
- **本地存储** - 使用 VSCode 的 globalState 持久化团队选择
- **实时同步** - 前后端实时同步团队和成员状态

### 性能优化

- **懒加载** - 团队检测和成员状态按需加载
- **缓存机制** - 缓存项目检测结果避免重复计算
- **异步处理** - 项目检测在后台异步进行

## 未来扩展

### 1. 更多团队类型

- **移动开发团队** - 专注于移动应用开发
- **DevOps 团队** - 专注于部署和运维
- **数据团队** - 专注于数据分析和机器学习

### 2. 高级协作功能

- **任务分配** - 智能分配任务给合适的团队成员
- **工作流程自动化** - 根据项目阶段自动推进工作流程
- **团队绩效** - 统计团队工作效率和成果

### 3. 个性化定制

- **自定义团队** - 允许用户创建自己的团队配置
- **成员定制** - 自定义团队成员的角色和能力
- **工作流程定制** - 根据团队特点定制工作流程

这个团队化系统将 HN Code 从单一的 AI 助手升级为一个完整的开发团队，为用户提供更加真实和专业的开发协作体验。
